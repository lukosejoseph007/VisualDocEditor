<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>VisualDocEditor</title>
  <style>
    :root { 
      --bg: #0f172a;
      --panel: #1e293b;
      --text: #f8fafc;
      --muted: #94a3b8;
      --accent: #0d9488;
      --accent-light: #14b8a6;
      --accent-dark: #0f766e;
      --success: #22c55e;
      --warning: #f59e0b;
      --error: #ef4444;
      --border: #334155;
      --hover: #2d3748;
      --active: #374151;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html, body { 
      height: 100vh; 
      width: 100vw; 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--bg); 
      color: var(--text);
      overflow: hidden;
    }
    
    /* Improved Toolbar */
    #toolbar { 
      background: var(--panel); 
      padding: 12px 16px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 16px;
      border-bottom: 1px solid var(--border);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    #toolbar section { 
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
    }
    
    /* Improved Buttons and Inputs */
    button, select, input { 
      padding: 8px 16px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
    }
    
    button:hover, select:hover {
      background: var(--hover);
      border-color: var(--accent-light);
      transform: translateY(-1px);
    }
    
    button:active, select:active {
      transform: translateY(0);
    }
    
    button.context-mode { 
      background: var(--accent-dark);
      border-color: var(--accent);
      color: white;
    }
    
    button.context-mode:hover { 
      background: var(--accent);
      border-color: var(--accent-light);
    }
    
    input[type="text"], input[type="password"] { 
      min-width: 200px;
      cursor: text;
      background: var(--bg);
      padding: 8px 12px;
    }
    
    input[type="text"]:focus, input[type="password"]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(13, 148, 136, 0.2);
    }
    
    /* Main Layout */
    #main { 
      display: flex;
      height: calc(100vh - 64px);
      width: 100vw;
    }
    
    /* Improved Sidebar */
    #sidebar { 
      width: 300px;
      background: var(--panel);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      box-shadow: 2px 0 4px rgba(0, 0, 0, 0.1);
    }
    
    #folderHeader { 
      padding: 16px;
      border-bottom: 1px solid var(--border);
      font-size: 13px;
      color: var(--muted);
      word-break: break-all;
      background: var(--bg);
      font-weight: 500;
    }
    
    #contextIndicator { 
      padding: 12px 16px;
      background: var(--accent-dark);
      border-bottom: 1px solid var(--border);
      font-size: 12px;
      color: white;
      font-weight: 500;
    }
    
    #fileSearchWrap { 
      padding: 12px;
      border-bottom: 1px solid var(--border);
      background: var(--panel);
    }
    
    #fileSearch {
      width: 100%;
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--text);
    }
    
    #fileSearch:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(13, 148, 136, 0.2);
    }
    
    #fileList { 
      flex: 1;
      overflow: auto;
      list-style: none;
      margin: 0;
      padding: 8px 0;
      background: var(--panel);
    }
    
    .fileItem { 
      padding: 12px 16px;
      cursor: pointer;
      border-bottom: 1px solid var(--border);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s ease;
    }
    
    .fileItem:hover { 
      background: var(--hover);
    }
    
    .fileItem.active { 
      background: var(--active);
      border-left: 4px solid var(--accent);
    }
    
    .fileItem.has-context { 
      border-right: 3px solid var(--accent);
    }
    
    .fileItem .format-badge { 
      font-size: 11px;
      background: var(--accent);
      color: white;
      padding: 4px 8px;
      border-radius: 6px;
      margin-left: 8px;
      font-weight: 600;
    }
    
    .pill { 
      font-size: 11px;
      color: var(--muted);
      background: var(--bg);
      padding: 4px 8px;
      border-radius: 12px;
      font-weight: 500;
    }
#editor { 
  flex: 1; 
  min-width: 0; 
  overflow: auto; 
  max-height: calc(100vh - 64px);
}

/* Improved Model Dropdown Styles */
.model-dropdown { 
  position: relative; 
}

.model-input-group { 
  display: flex;
  align-items: center;
  gap: 8px;
}

#modelDropdown, #provider, #aiMode, #exportFormat { 
  min-width: 200px;
  max-width: 300px;
  background: var(--bg);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
}

#modelDropdown:focus, #provider:focus, #aiMode:focus, #exportFormat:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 2px rgba(13, 148, 136, 0.2);
}

.model-actions { 
  display: flex;
  gap: 4px;
}

.model-btn { 
  padding: 6px 10px;
  font-size: 12px;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.model-btn:hover {
  background: var(--accent-light);
  transform: translateY(-1px);
}

.model-btn:active {
  transform: translateY(0);
}

.dropdown-content { 
  position: absolute;
  top: 100%;
  left: 0;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 8px;
  min-width: 250px;
  max-height: 300px;
  overflow-y: auto;
  z-index: 1000;
  display: none;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
  margin-top: 4px;
}

.dropdown-content.show { 
  display: block;
}

.dropdown-item { 
  padding: 12px 16px;
  cursor: pointer;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.2s ease;
}

.dropdown-item:hover { 
  background: var(--hover);
}

.dropdown-item:last-child { 
  border-bottom: none;
}

.dropdown-item .model-name { 
  flex: 1;
  font-weight: 500;
}

.dropdown-item .delete-btn { 
  color: var(--error);
  font-size: 12px;
  padding: 4px 8px;
  border-radius: 4px;
  opacity: 0.7;
  transition: all 0.2s ease;
}

.dropdown-item .delete-btn:hover { 
  opacity: 1;
  background: rgba(239, 68, 68, 0.1);
}

/* Format indicator */
.format-indicator { 
  position: absolute;
  top: -6px;
  right: -6px;
  background: var(--warning);
  color: #000;
  font-size: 10px;
  padding: 3px 8px;
  border-radius: 10px;
  font-weight: bold;
}

/* Labels styling */
label {
  font-size: 13px;
  font-weight: 600;
  color: var(--muted);
  margin-bottom: 4px;
  display: block;
}

/* Toolbar section improvements */
#toolbar section {
  padding: 8px 0;
  border-right: 1px solid var(--border);
  padding-right: 16px;
}

#toolbar section:last-child {
  border-right: none;
}

/* Loading states */
.loading {
  opacity: 0.7;
  pointer-events: none;
}

.loading::after {
  content: '';
  display: inline-block;
  width: 12px;
  height: 12px;
  border: 2px solid var(--accent);
  border-radius: 50%;
  border-top-color: transparent;
  animation: spin 1s linear infinite;
  margin-left: 8px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Error states */
.error {
  border-color: var(--error) !important;
  background: rgba(239, 68, 68, 0.1) !important;
}

.error-message {
  color: var(--error);
  font-size: 12px;
  margin-top: 4px;
  font-weight: 500;
}

/* Success states */
.success {
  border-color: var(--success) !important;
  background: rgba(34, 197, 94, 0.1) !important;
}
  </style>
</head>
<body>
  <div id="toolbar">
    <!-- File Operations -->
    <section>
      <button id="openFolderBtn">Open Folder</button>
      <button id="openBtn">Open File</button>
      <button id="saveBtn">Save</button>
      <select id="exportFormat" title="Select export format">
        <option value="md">Export as MD</option>
        <option value="docx">Export as DOCX</option>
        <option value="pptx">Export as PPTX</option>
        <option value="html">Export as HTML</option>
        <option value="txt">Export as TXT</option>
      </select>
      <button id="exportBtn">Export</button>
    </section>

    <!-- Single File AI -->
    <section>
      <button id="aiImprove">Improve</button>
      <button id="aiSummarize">Summarize</button>
      <input id="aiQuestion" type="text" placeholder="Ask a question..." />
      <button id="aiAsk">Ask</button>
    </section>

    <!-- Multi-File AI -->
    <section>
      <button id="aiExplain" class="context-mode">Explain</button>
      <button id="aiConnect" class="context-mode">Connect</button>
      <button id="aiFind" class="context-mode">Find Similar</button>
      <button id="aiOverview" class="context-mode">Overview</button>
    </section>

    <!-- AI Settings -->
    <section>
      <label>Provider:</label>
      <select id="provider" title="Select AI provider">
        <option value="openrouter" selected>OpenRouter</option>
        <option value="openai">OpenAI</option>
      </select>

      <label>API Key:</label>
      <input id="apiKey" type="password" placeholder="Enter API Key" />

      <div class="model-dropdown">
        <label>Model:</label>
        <div class="model-input-group">
          <select id="modelDropdown" title="Select AI model">
            <option value="">Select or type model...</option>
          </select>
          <input id="modelInput" type="text" placeholder="Type model name..." style="min-width:180px;" />
          <div class="model-actions">
            <button id="addModelBtn" class="model-btn" title="Add current model to list">+</button>
            <button id="clearModelsBtn" class="model-btn" title="Clear models list">Clear</button>
          </div>
        </div>
      </div>

      <label>Mode:</label>
      <select id="aiMode" title="Select AI response mode">
        <option value="append">Append</option>
        <option value="replace">Replace</option>
      </select>
    </section>
  </div>

  <div id="main">
    <aside id="sidebar">
      <div id="folderHeader">No folder open</div>
      <div id="contextIndicator">Context: Not ready</div>
      <div id="fileSearchWrap">
        <input id="fileSearch" type="text" placeholder="Filter files... (Ctrl+K)" style="width:100%" />
      </div>
      <ul id="fileList"></ul>
    </aside>
    <div id="editor"></div>
  </div>

  <script type="module" src="./renderer.mjs"></script>
</body>
</html>
